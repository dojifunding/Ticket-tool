<%- include('../partials/head') %>

<div class="page-header">
  <div>
    <a href="/admin/companies" class="back-link">â† Retour aux entreprises</a>
    <h1 class="page-title">Modifier l'entreprise</h1>
    <p class="page-subtitle">ğŸ¢ <%= company.name %></p>
  </div>
</div>

<div class="detail-layout" style="max-width:800px">
  <div class="detail-main">
    <div class="card">
      <div class="card-header"><h2>ğŸ¢ Informations</h2></div>
      <div class="card-body">
        <form method="POST" action="/admin/companies/<%= company.id %>/edit">
          <div class="form-group">
            <label><strong>Nom de l'entreprise *</strong></label>
            <input type="text" name="name" value="<%= company.name %>" required>
          </div>
          <div class="form-group">
            <label>Email de contact</label>
            <input type="email" name="contact_email" value="<%= company.contact_email || '' %>" placeholder="contact@acme.com">
          </div>
          <div class="form-group">
            <label>Site web</label>
            <input type="url" name="website" value="<%= company.website || '' %>" placeholder="https://acme.com">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea name="description" rows="3" placeholder="BrÃ¨ve description..."><%= company.description || '' %></textarea>
          </div>

          <hr style="margin:1.25rem 0;border-color:var(--border)">

          <div class="form-group">
            <label><strong>ğŸ‘¥ Utilisateurs assignÃ©s</strong></label>
            <p class="text-muted" style="font-size:.8rem;margin:.25rem 0 .5rem">Ces utilisateurs pourront voir et gÃ©rer les tickets de cette entreprise.</p>
            <div class="checkbox-grid">
              <% allUsers.forEach(u => { %>
                <label class="checkbox-item">
                  <input type="checkbox" name="user_ids" value="<%= u.id %>"
                    <%= assignedUsers.find(a => a.id === u.id) ? 'checked' : '' %>>
                  <div>
                    <span><%= u.full_name %></span>
                    <span class="text-muted text-sm" style="display:block"><%= u.role %></span>
                  </div>
                </label>
              <% }) %>
            </div>
          </div>

          <div style="margin-top:1.5rem;display:flex;gap:.5rem">
            <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
            <a href="/admin/companies" class="btn btn-ghost">Annuler</a>
          </div>
        </form>
      </div>
    </div>

    <div class="card" style="margin-top:1rem">
      <div class="card-header"><h2>ğŸ“Š Informations</h2></div>
      <div class="card-body">
        <div class="stats-mini-grid">
          <div class="stat-mini">
            <div class="stat-mini-label">Slug</div>
            <div class="stat-mini-value"><%= company.slug %></div>
          </div>
          <div class="stat-mini">
            <div class="stat-mini-label">CrÃ©Ã© le</div>
            <div class="stat-mini-value"><%= new Date(company.created_at).toLocaleDateString('fr-FR') %></div>
          </div>
          <div class="stat-mini">
            <div class="stat-mini-label">Utilisateurs</div>
            <div class="stat-mini-value"><%= assignedUsers.length %></div>
          </div>
          <div class="stat-mini">
            <div class="stat-mini-label">Statut</div>
            <div class="stat-mini-value" style="color:<%= company.is_active ? 'var(--success)' : 'var(--danger)' %>">
              <%= company.is_active ? 'âœ… Actif' : 'âŒ Inactif' %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: .4rem; }
  .checkbox-item { display: flex; align-items: center; gap: .5rem; padding: .5rem .6rem; border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer; font-size: .85rem; transition: background .15s; }
  .checkbox-item:hover { background: var(--bg-secondary); }
  .checkbox-item input[type="checkbox"] { margin: 0; flex-shrink: 0; }
  .stats-mini-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: .75rem; }
  .stat-mini { padding: .75rem; background: var(--bg-secondary); border-radius: var(--radius); border: 1px solid var(--border); }
  .stat-mini-label { font-size: .75rem; color: var(--text-muted); margin-bottom: .25rem; }
  .stat-mini-value { font-size: .9rem; font-weight: 600; }
</style>

<%- include('../partials/foot') %>
